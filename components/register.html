<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card shadow-lg border-0 rounded-lg mt-4">
                <div class="card-header bg-gradient-primary text-white text-center py-4">
                    <h3 class="font-weight-light my-2">
                        <i class="fas fa-user-plus me-2"></i>
                        Crea il tuo Account
                    </h3>
                    <p class="mb-0">Unisciti alla piattaforma di orientamento professionale</p>
                </div>
                <div class="card-body p-5">
                    <!-- Registration Steps -->
                    <div class="registration-steps mb-4">
                        <div class="step active" id="step1">
                            <div class="step-number">1</div>
                            <div class="step-label">Informazioni Personali</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" id="step2">
                            <div class="step-number">2</div>
                            <div class="step-label">Credenziali</div>
                        </div>
                        <div class="step-line"></div>
                        <div class="step" id="step3">
                            <div class="step-number">3</div>
                            <div class="step-label">Conferma</div>
                        </div>
                    </div>

                    <form id="registerForm" novalidate>
                        <!-- Step 1: Personal Information -->
                        <div class="registration-step active" id="personalInfo">
                            <h5 class="mb-4 text-primary">
                                <i class="fas fa-user me-2"></i>
                                Informazioni Personali
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label">
                                        <i class="fas fa-user me-2"></i>
                                        Nome *
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="firstName" 
                                        name="firstName" 
                                        placeholder="Il tuo nome"
                                        required
                                    >
                                    <div class="invalid-feedback" id="firstNameError"></div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label">
                                        <i class="fas fa-user me-2"></i>
                                        Cognome *
                                    </label>
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="lastName" 
                                        name="lastName" 
                                        placeholder="Il tuo cognome"
                                        required
                                    >
                                    <div class="invalid-feedback" id="lastNameError"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="email" class="form-label">
                                    <i class="fas fa-envelope me-2"></i>
                                    Email *
                                </label>
                                <input 
                                    type="email" 
                                    class="form-control" 
                                    id="email" 
                                    name="email" 
                                    placeholder="La tua email"
                                    required
                                >
                                <div class="invalid-feedback" id="emailError"></div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Utilizzeremo questa email per inviarti le notifiche delle opportunità
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="dateOfBirth" class="form-label">
                                    <i class="fas fa-calendar me-2"></i>
                                    Data di Nascita
                                </label>
                                <input 
                                    type="date" 
                                    class="form-control" 
                                    id="dateOfBirth" 
                                    name="dateOfBirth"
                                    max="2006-01-01"
                                >
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Opzionale - ci aiuta a personalizzare meglio le opportunità
                                </div>
                            </div>

                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" onclick="goToStep(2)">
                                    Avanti
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Credentials -->
                        <div class="registration-step" id="credentials">
                            <h5 class="mb-4 text-primary">
                                <i class="fas fa-lock me-2"></i>
                                Credenziali di Accesso
                            </h5>

                            <div class="mb-3">
                                <label for="password" class="form-label">
                                    <i class="fas fa-lock me-2"></i>
                                    Password *
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="password" 
                                        class="form-control" 
                                        id="password" 
                                        name="password" 
                                        placeholder="Scegli una password sicura"
                                        required
                                    >
                                    <button 
                                        class="btn btn-outline-secondary" 
                                        type="button" 
                                        onclick="togglePasswordVisibility('password', 'passwordIcon')"
                                    >
                                        <i class="fas fa-eye" id="passwordIcon"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback" id="passwordError"></div>
                                <div class="password-strength" id="passwordStrength">
                                    <div class="strength-bar">
                                        <div class="strength-fill" id="strengthFill"></div>
                                    </div>
                                    <small class="strength-text" id="strengthText">Inserisci almeno 6 caratteri</small>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="confirmPassword" class="form-label">
                                    <i class="fas fa-lock me-2"></i>
                                    Conferma Password *
                                </label>
                                <div class="input-group">
                                    <input 
                                        type="password" 
                                        class="form-control" 
                                        id="confirmPassword" 
                                        name="confirmPassword" 
                                        placeholder="Ripeti la password"
                                        required
                                    >
                                    <button 
                                        class="btn btn-outline-secondary" 
                                        type="button" 
                                        onclick="togglePasswordVisibility('confirmPassword', 'confirmPasswordIcon')"
                                    >
                                        <i class="fas fa-eye" id="confirmPasswordIcon"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback" id="confirmPasswordError"></div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="goToStep(1)">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Indietro
                                </button>
                                <button type="button" class="btn btn-primary" onclick="goToStep(3)">
                                    Avanti
                                    <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Terms and Confirmation -->
                        <div class="registration-step" id="confirmation">
                            <h5 class="mb-4 text-primary">
                                <i class="fas fa-check-circle me-2"></i>
                                Conferma Registrazione
                            </h5>

                            <!-- Summary -->
                            <div class="registration-summary mb-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">Riepilogo dei tuoi dati:</h6>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <strong>Nome:</strong> <span id="summaryName">-</span>
                                            </div>
                                            <div class="col-sm-6">
                                                <strong>Email:</strong> <span id="summaryEmail">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Terms and Conditions -->
                            <div class="mb-3">
                                <div class="form-check">
                                    <input 
                                        class="form-check-input" 
                                        type="checkbox" 
                                        id="termsAccepted" 
                                        name="termsAccepted"
                                        required
                                    >
                                    <label class="form-check-label" for="termsAccepted">
                                        Accetto i <a href="#" onclick="showTerms()">Termini e Condizioni</a> e 
                                        l'<a href="#" onclick="showPrivacy()">Informativa sulla Privacy</a> *
                                    </label>
                                    <div class="invalid-feedback" id="termsError"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="form-check">
                                    <input 
                                        class="form-check-input" 
                                        type="checkbox" 
                                        id="newsletterConsent" 
                                        name="newsletterConsent"
                                    >
                                    <label class="form-check-label" for="newsletterConsent">
                                        Desidero ricevere aggiornamenti sulle nuove opportunità e consigli di carriera
                                    </label>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2)">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Indietro
                                </button>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-user-plus me-2"></i>
                                    Completa Registrazione
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-footer bg-light text-center py-3">
                    <div class="small">
                        Hai già un account?
                        <a href="#" id="loginLink" class="text-decoration-none fw-bold">
                            <i class="fas fa-sign-in-alt me-1"></i>
                            Accedi qui
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.registration-steps {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 2rem;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
}

.step.active .step-number,
.step.completed .step-number {
    background: var(--primary-color);
    color: white;
}

.step.completed .step-number {
    background: var(--success-color);
}

.step-label {
    font-size: 0.85rem;
    color: #6c757d;
    max-width: 80px;
}

.step.active .step-label {
    color: var(--primary-color);
    font-weight: 600;
}

.step-line {
    flex: 1;
    height: 2px;
    background: #e9ecef;
    margin: 0 1rem;
    max-width: 100px;
}

.registration-step {
    display: none;
}

.registration-step.active {
    display: block;
    animation: fadeInSlideUp 0.3s ease;
}

.password-strength {
    margin-top: 0.5rem;
}

.strength-bar {
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 0.25rem;
}

.strength-fill {
    height: 100%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.strength-weak { background: #dc3545; width: 25%; }
.strength-fair { background: #fd7e14; width: 50%; }
.strength-good { background: #ffc107; width: 75%; }
.strength-strong { background: #28a745; width: 100%; }

.registration-summary .card {
    border: 1px solid rgba(102, 126, 234, 0.2);
}

@keyframes fadeInSlideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 576px) {
    .registration-steps {
        margin-bottom: 1rem;
    }
    
    .step-label {
        font-size: 0.75rem;
        max-width: 60px;
    }
    
    .step-line {
        max-width: 30px;
        margin: 0 0.5rem;
    }
    
    .card-body {
        padding: 2rem 1.5rem;
    }
}
</style>

<script>
let currentStep = 1;

// Step navigation
function goToStep(step) {
    if (step < currentStep || validateCurrentStep()) {
        // Hide current step
        document.querySelectorAll('.registration-step').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active', 'completed'));
        
        // Show target step
        const stepId = getStepId(step);
        document.getElementById(stepId).classList.add('active');
        
        // Update step indicators
        for (let i = 1; i <= 3; i++) {
            const stepEl = document.getElementById(`step${i}`);
            if (i < step) {
                stepEl.classList.add('completed');
            } else if (i === step) {
                stepEl.classList.add('active');
            }
        }
        
        // Update summary if going to step 3
        if (step === 3) {
            updateSummary();
        }
        
        currentStep = step;
    }
}

function getStepId(step) {
    const steps = ['', 'personalInfo', 'credentials', 'confirmation'];
    return steps[step];
}

function validateCurrentStep() {
    switch (currentStep) {
        case 1:
            return validatePersonalInfo();
        case 2:
            return validateCredentials();
        case 3:
            return validateConfirmation();
        default:
            return true;
    }
}

function validatePersonalInfo() {
    let isValid = true;
    
    // Validate first name
    const firstName = document.getElementById('firstName');
    const firstNameError = document.getElementById('firstNameError');
    if (!firstName.value.trim()) {
        firstName.classList.add('is-invalid');
        firstNameError.textContent = 'Nome è obbligatorio';
        isValid = false;
    } else {
        firstName.classList.remove('is-invalid');
        firstName.classList.add('is-valid');
        firstNameError.textContent = '';
    }
    
    // Validate last name
    const lastName = document.getElementById('lastName');
    const lastNameError = document.getElementById('lastNameError');
    if (!lastName.value.trim()) {
        lastName.classList.add('is-invalid');
        lastNameError.textContent = 'Cognome è obbligatorio';
        isValid = false;
    } else {
        lastName.classList.remove('is-invalid');
        lastName.classList.add('is-valid');
        lastNameError.textContent = '';
    }
    
    // Validate email
    const email = document.getElementById('email');
    const emailError = document.getElementById('emailError');
    if (!email.value.trim()) {
        email.classList.add('is-invalid');
        emailError.textContent = 'Email è obbligatoria';
        isValid = false;
    } else if (!Utils.validateEmail(email.value.trim())) {
        email.classList.add('is-invalid');
        emailError.textContent = 'Formato email non valido';
        isValid = false;
    } else {
        email.classList.remove('is-invalid');
        email.classList.add('is-valid');
        emailError.textContent = '';
    }
    
    return isValid;
}

function validateCredentials() {
    let isValid = true;
    
    // Validate password
    const password = document.getElementById('password');
    const passwordError = document.getElementById('passwordError');
    if (!password.value) {
        password.classList.add('is-invalid');
        passwordError.textContent = 'Password è obbligatoria';
        isValid = false;
    } else if (password.value.length < 6) {
        password.classList.add('is-invalid');
        passwordError.textContent = 'Password deve essere di almeno 6 caratteri';
        isValid = false;
    } else {
        password.classList.remove('is-invalid');
        password.classList.add('is-valid');
        passwordError.textContent = '';
    }
    
    // Validate confirm password
    const confirmPassword = document.getElementById('confirmPassword');
    const confirmPasswordError = document.getElementById('confirmPasswordError');
    if (!confirmPassword.value) {
        confirmPassword.classList.add('is-invalid');
        confirmPasswordError.textContent = 'Conferma password è obbligatoria';
        isValid = false;
    } else if (confirmPassword.value !== password.value) {
        confirmPassword.classList.add('is-invalid');
        confirmPasswordError.textContent = 'Le password non coincidono';
        isValid = false;
    } else {
        confirmPassword.classList.remove('is-invalid');
        confirmPassword.classList.add('is-valid');
        confirmPasswordError.textContent = '';
    }
    
    return isValid;
}

function validateConfirmation() {
    let isValid = true;
    
    // Validate terms acceptance
    const termsAccepted = document.getElementById('termsAccepted');
    const termsError = document.getElementById('termsError');
    if (!termsAccepted.checked) {
        termsAccepted.classList.add('is-invalid');
        termsError.textContent = 'Devi accettare i termini e condizioni';
        isValid = false;
    } else {
        termsAccepted.classList.remove('is-invalid');
        termsError.textContent = '';
    }
    
    return isValid;
}

// Password strength checker
function checkPasswordStrength(password) {
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    
    if (!password) {
        strengthFill.className = 'strength-fill';
        strengthText.textContent = 'Inserisci almeno 6 caratteri';
        return;
    }
    
    let strength = 0;
    let feedback = [];
    
    // Length check
    if (password.length >= 8) strength += 1;
    else feedback.push('almeno 8 caratteri');
    
    // Uppercase check
    if (/[A-Z]/.test(password)) strength += 1;
    else feedback.push('una maiuscola');
    
    // Lowercase check
    if (/[a-z]/.test(password)) strength += 1;
    else feedback.push('una minuscola');
    
    // Number check
    if (/\d/.test(password)) strength += 1;
    else feedback.push('un numero');
    
    // Special character check
    if (/[^A-Za-z0-9]/.test(password)) strength += 1;
    else feedback.push('un carattere speciale');
    
    // Update UI
    strengthFill.classList.remove('strength-weak', 'strength-fair', 'strength-good', 'strength-strong');
    
    if (strength <= 1) {
        strengthFill.classList.add('strength-weak');
        strengthText.textContent = 'Password troppo debole';
        strengthText.className = 'strength-text text-danger';
    } else if (strength <= 2) {
        strengthFill.classList.add('strength-fair');
        strengthText.textContent = 'Password debole';
        strengthText.className = 'strength-text text-warning';
    } else if (strength <= 3) {
        strengthFill.classList.add('strength-good');
        strengthText.textContent = 'Password buona';
        strengthText.className = 'strength-text text-info';
    } else {
        strengthFill.classList.add('strength-strong');
        strengthText.textContent = 'Password forte';
        strengthText.className = 'strength-text text-success';
    }
    
    if (feedback.length > 0 && password.length >= 6) {
        strengthText.textContent += ` (manca: ${feedback.join(', ')})`;
    }
}

function updateSummary() {
    document.getElementById('summaryName').textContent = 
        `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`;
    document.getElementById('summaryEmail').textContent = 
        document.getElementById('email').value;
}

function togglePasswordVisibility(inputId, iconId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function showTerms() {
    const modal = Utils.createModal('termsModal', 'Termini e Condizioni', `
        <div class="terms-content">
            <h6>1. Accettazione dei Termini</h6>
            <p>Utilizzando Career Guidance, accetti questi termini e condizioni.</p>
            
            <h6>2. Utilizzo del Servizio</h6>
            <p>Il servizio è fornito per scopi di orientamento professionale e ricerca di opportunità lavorative.</p>
            
            <h6>3. Privacy dei Dati</h6>
            <p>I tuoi dati personali saranno trattati secondo la nostra Informativa sulla Privacy.</p>
            
            <h6>4. Responsabilità</h6>
            <p>Utilizzi il servizio a tuo rischio. Non garantiamo risultati specifici.</p>
            
            <h6>5. Modifiche</h6>
            <p>Ci riserviamo il diritto di modificare questi termini in qualsiasi momento.</p>
        </div>
    `, {
        footer: '<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Ho Capito</button>'
    });
    
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
}

function showPrivacy() {
    const modal = Utils.createModal('privacyModal', 'Informativa sulla Privacy', `
        <div class="privacy-content">
            <h6>Raccolta dei Dati</h6>
            <p>Raccogliamo solo i dati necessari per fornire il servizio di orientamento professionale.</p>
            
            <h6>Utilizzo dei Dati</h6>
            <p>I tuoi dati vengono utilizzati per:</p>
            <ul>
                <li>Analisi del profilo professionale</li>
                <li>Matching con opportunità lavorative</li>
                <li>Comunicazioni relative al servizio</li>
            </ul>
            
            <h6>Condivisione dei Dati</h6>
            <p>I tuoi dati non vengono condivisi con terze parti senza il tuo consenso esplicito.</p>
            
            <h6>Sicurezza</h6>
            <p>Implementiamo misure di sicurezza appropriate per proteggere i tuoi dati.</p>
            
            <h6>I Tuoi Diritti</h6>
            <p>Hai il diritto di accedere, modificare o eliminare i tuoi dati in qualsiasi momento.</p>
        </div>
    `, {
        footer: '<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Ho Capito</button>'
    });
    
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Password strength checker
    const passwordInput = document.getElementById('password');
    passwordInput.addEventListener('input', function() {
        checkPasswordStrength(this.value);
    });
    
    // Real-time validation
    const inputs = ['firstName', 'lastName', 'email', 'password', 'confirmPassword'];
    inputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('blur', function() {
                if (currentStep === 1 && ['firstName', 'lastName', 'email'].includes(inputId)) {
                    validatePersonalInfo();
                } else if (currentStep === 2 && ['password', 'confirmPassword'].includes(inputId)) {
                    validateCredentials();
                }
            });
        }
    });
});
</script>
